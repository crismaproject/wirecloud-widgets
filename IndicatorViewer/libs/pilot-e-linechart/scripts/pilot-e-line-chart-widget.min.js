angular.module("eu.crismaproject.pilotE.linechart",["eu.crismaproject.pilotE.linechart.directives"]),angular.module("eu.crismaproject.pilotE.linechart.directives",["nvd3ChartDirectives","ngResource"]),angular.module("eu.crismaproject.pilotE.linechart.directives").directive("pilotELinechart",[function(){"use strict";var a,b;return b={worldstateId:"=",width:"=?",height:"=?"},a=["$scope","ICMM_API","$resource","$q",function(a,b,c,d){var e,f,g,h,i;e=function(){var e,j,k,l;e=c(b+"/CRISMA.worldstates/"+a.worldstateId+"?deduplicate=true&omitNullValues=false"),e.get({},function(a){var b,e,m,n,o,p;m=c("https://crisma-pilote.ait.ac.at/api/entity?wsId=:wsId"),o=c("https://crisma-pilote.ait.ac.at/api/worldstate/:wsId"),b=function(a,c){null!==a.parentworldstate&&b(a.parentworldstate,c),a.worldstatedata.some(function(a){var b;return 1===a.datadescriptor.id||0===a.datadescriptor.$ref.indexOf("/CRISMA.datadescriptors/1")?(b=JSON.parse(a.actualaccessinfo),c.push(b.id),!0):!1})},n=[],b(a,n),f.splice(0,f.length),e=null,j=[],k=[],n.forEach(function(a){var b;b=o.get({wsId:a}).$promise,k.push(b)}),p=function(a){var b,c;return b=l[0],c=l[a],parseInt((Date.parse(c.dateTime)-Date.parse(b.dateTime))/6e4)},d.all(k).then(function(a){l=a,n.forEach(function(a){var b;b=m.query({wsId:a}).$promise,j.push(b),b.then(function(b){b.forEach(function(b){if(40===b.entityTypeId&&a===n[0]){var c,d={x:0,y:0};b.entityInstancesProperties.forEach(function(a){2===a.entityTypePropertyId?d.x=parseInt(a.entityPropertyValue):a.entityTypePropertyId>=3&&a.entityTypePropertyId<=9&&(d.y+=parseInt(a.entityPropertyValue))}),c=f.some(function(a){return a.x===d.x?(a.y+=d.y,!0):!1}),c||f.push(d)}else 14===b.entityTypeId&&a===n[0]&&"Incident Area"===b.entityName&&b.entityInstancesProperties.some(function(a){544===a.entityTypePropertyId&&(e=a.entityPropertyValue)})})})}),d.all(j).then(function(a){var b,c;c=new Terraformer.Polygon(Terraformer.WKT.parse(e)),f.sort(function(a,b){return a.x-b.x}),b=0,a.forEach(function(a){var d,e,f,j;d=e=f=0,a.forEach(function(a){var b,g,h;g=!1,7===a.entityTypeId&&(a.entityInstancesGeometry&&a.entityInstancesGeometry[0]&&a.entityInstancesGeometry[0].geometry&&a.entityInstancesGeometry[0].geometry.geometry&&a.entityInstancesGeometry[0].geometry.geometry.wellKnownText&&(b=Terraformer.WKT.parse(a.entityInstancesGeometry[0].geometry.geometry.wellKnownText),h=c.coordinates[0][0],Math.abs(h[0]-b.coordinates[0])>Math.abs(h[0]-b.coordinates[1])&&(h=b.coordinates[0],b.coordinates[0]=b.coordinates[1],b.coordinates[1]=h)),b&&Terraformer.Tools.polygonContainsPoint(c.coordinates,b.coordinates)?d++:(a.entityInstancesProperties.forEach(function(a){1e3===a.entityTypePropertyId&&(a.entityPropertyValue.indexOf("Treat")>=0||a.entityPropertyValue.indexOf("Rescue")>=0||a.entityPropertyValue.indexOf("Evacuate")>=0||a.entityPropertyValue.indexOf("Dispatch")>=0)&&(f++,g=!0)}),g&&a.entityInstancesProperties.forEach(function(a){var b;312===a.entityTypePropertyId&&(b=parseInt(a.entityPropertyValue),(0===b||-1===b)&&e++)})))}),j=p(b),g.push({x:j,y:d}),h.push({x:j,y:f}),i.push({x:j,y:e}),b++})})})})},f=[],g=[],h=[],i=[],a.data=[{values:f,key:"Vehicles (requested)"},{values:i,key:"Vehicles (alarmed)"},{values:h,key:"Vehicles (on the way)"},{values:g,key:"Vehicles (on site)"}],a.height||(a.height=480),a.xAxisTickFormatFunction=function(){return function(a){return a+" min"}},a.yAxisTickFormatFunction=function(){return function(a){return a}},a.xFunction=function(){return function(a){return a.x}},a.yFunction=function(){return function(a){return a.y}},a.$watch("worldstateId",function(a){a&&e()})}],{scope:b,controller:a,restrict:"E",templateUrl:"templates/pilotELinechart.html"}}]),angular.module("eu.crismaproject.pilotE.linechart.directives").run(["$templateCache",function(a){"use strict";a.put("templates/pilotELinechart.html",'<div><nvd3-line-with-focus-chart data=data id=pilot-e-linechart height={{height}} height2="{{height / 5}}" width={{width}} showxaxis=true showyaxis=true showlegend=true xaxistickformat=xAxisTickFormatFunction() yaxistickformat=yAxisTickFormatFunction() x=xFunction() y=yFunction() interactive=true useinteractiveguideline=true tooltips=true objectequality=true><svg></svg></nvd3-line-with-focus-chart></div>')}]);
//# sourceMappingURL=pilot-e-line-chart-widget.min.js.map